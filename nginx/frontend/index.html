<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        /* ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS ... */
        
        .debug {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="debug" id="debug">Debug: Ready</div>
    
    <div id="app">
        <div class="logo">üê± Fe</div>
        
        <div v-if="!token">
            <div class="character"></div>
            
            <div class="card" v-if="showRegister">
                <h1>Create Account</h1>
                <div class="form-group">
                    <label>Username</label>
                    <input v-model="register.username" placeholder="SuperHero123">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input v-model="register.email" placeholder="hello@example.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input v-model="register.password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button class="btn" @click="handleRegister" :disabled="loading">
                    {{ loading ? 'Loading...' : 'Sign Up' }}
                </button>
                <p class="error">{{ registerError }}</p>
                <div class="switch-form">
                    Already have an account? <a @click="showRegister = false">Login</a>
                </div>
            </div>
            
            <div class="card" v-else>
                <h1>Welcome Back!</h1>
                <div class="form-group">
                    <label>Email</label>
                    <input v-model="login.email" placeholder="hello@example.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input v-model="login.password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button class="btn" @click="handleLogin" :disabled="loading">
                    {{ loading ? 'Loading...' : 'Login' }}
                </button>
                <p class="error">{{ loginError }}</p>
                <div class="switch-form">
                    New here? <a @click="showRegister = true">Create Account</a>
                </div>
            </div>
        </div>
        
        <div v-else>
            <div class="card">
                <h1>üéâ Welcome! üéâ</h1>
                <p>You're successfully logged in!</p>
                <button class="btn btn-secondary" @click="logout">Logout</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://3.235.179.90:5000/api';
        
        function debug(msg) {
            console.log(msg);
            document.getElementById('debug').innerHTML = 'Debug: ' + msg;
        }

        const app = new Vue({
            el: '#app',
            data: {
                token: localStorage.getItem('token') || null,
                showRegister: false,
                register: { username: '', email: '', password: '' },
                login: { email: '', password: '' },
                registerError: '',
                loginError: '',
                loading: false
            },
            created() {
                debug('App started. API_BASE: ' + API_BASE);
                this.testConnection();
            },
            methods: {
                async testConnection() {
                    debug('Testing connection to: ' + API_BASE);
                    try {
                        const response = await axios.get(API_BASE + '/', { 
                            timeout: 3000 
                        });
                        debug('‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω: ' + JSON.stringify(response.data));
                    } catch (error) {
                        debug('‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + error.message);
                        this.registerError = 'API —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                        this.loginError = 'API —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                    }
                },
                
                async handleRegister() {
                    this.registerError = '';
                    this.loading = true;
                    debug('Starting registration...');
                    
                    try {
                        debug('Sending to: ' + API_BASE + '/register');
                        debug('Data: ' + JSON.stringify(this.register));
                        
                        const res = await axios.post(API_BASE + '/register', this.register, {
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            timeout: 10000
                        });
                        
                        debug('‚úÖ Response received: ' + JSON.stringify(res.data));
                        
                        if (res.data.token) {
                            this.token = res.data.token;
                            localStorage.setItem('token', this.token);
                            alert('‚úÖ Registration successful!');
                            debug('‚úÖ Token saved to localStorage');
                        } else {
                            this.registerError = 'No token in response';
                            debug('‚ùå No token in response');
                        }
                    } catch (err) {
                        debug('‚ùå Registration error: ' + err.message);
                        
                        if (err.response) {
                            debug('Error details: ' + JSON.stringify(err.response.data));
                            this.registerError = err.response.data?.error || 
                                `Server error ${err.response.status}: ${err.response.statusText}`;
                        } else if (err.request) {
                            debug('No response from server');
                            this.registerError = 'Server not responding. Check: 1) Is backend running? 2) Port 5000 open?';
                        } else {
                            debug('Request setup error: ' + err.message);
                            this.registerError = 'Request error: ' + err.message;
                        }
                    } finally {
                        this.loading = false;
                    }
                },
                
                async handleLogin() {
                    this.loginError = '';
                    this.loading = true;
                    debug('Starting login...');
                    
                    try {
                        debug('Sending to: ' + API_BASE + '/login');
                        
                        const res = await axios.post(API_BASE + '/login', this.login, {
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            timeout: 10000
                        });
                        
                        debug('‚úÖ Login response: ' + JSON.stringify(res.data));
                        
                        if (res.data.token) {
                            this.token = res.data.token;
                            localStorage.setItem('token', this.token);
                            alert('‚úÖ Login successful!');
                            debug('‚úÖ Token saved');
                        } else {
                            this.loginError = 'Invalid email or password';
                            debug('‚ùå No token in login response');
                        }
                    } catch (err) {
                        debug('‚ùå Login error: ' + err.message);
                        
                        if (err.response) {
                            this.loginError = err.response.data?.error || 
                                `Error ${err.response.status}: ${err.response.statusText}`;
                        } else if (err.request) {
                            this.loginError = 'Server not responding';
                        } else {
                            this.loginError = 'Request error: ' + err.message;
                        }
                    } finally {
                        this.loading = false;
                    }
                },
                
                logout() {
                    this.token = null;
                    localStorage.removeItem('token');
                    this.showRegister = false;
                    debug('Logged out');
                    alert('üëã Logged out');
                }
            }
        });
        
        axios.interceptors.request.use(function (config) {
            debug('Request: ' + config.method.toUpperCase() + ' ' + config.url);
            return config;
        }, function (error) {
            debug('Request error: ' + error.message);
            return Promise.reject(error);
        });
        
        axios.interceptors.response.use(function (response) {
            debug('Response: ' + response.status + ' from ' + response.config.url);
            return response;
        }, function (error) {
            debug('Response error: ' + error.message);
            return Promise.reject(error);
        });
    </script>
</body>
</html>